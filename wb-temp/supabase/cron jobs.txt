-- Step 1: Enable the pg_cron extension (agar pehle se enabled nahi hai to)
CREATE EXTENSION IF NOT EXISTS pg_cron;

-- Step 2: Schedule the daily job to delete old pending orders
-- Yeh job har roz raat 12 baje (UTC time) chalega.
SELECT cron.schedule(
  'delete-old-pending-orders', -- Job ka naam
  '0 0 * * *',                 -- Cron schedule (har roz raat 12 baje)
  $$
  DELETE FROM public.orders
  WHERE status = 'PENDING'
  AND created_at < NOW() - INTERVAL '20 days';
  $$
);

-- (Optional) Agar aapko yeh job kabhi rokna ho, to neeche di gayi command run karein:
-- SELECT cron.unschedule('delete-old-pending-orders');
